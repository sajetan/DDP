///******************************************************************
// * This is the main file for the Software Sessions
// *
// */
//
//#include <stdint.h>
//#include <inttypes.h>
//
//#include "common.h"
//#include <string.h>
//
//// Uncomment for Session SW1
//extern void warmup();
//
//// Uncomment for Session SW2 onwards
////#include "mp_arith.h"
////#include "montgomery.h"
////#include "asm_func.h"
//
//
//int main()
//{
//    init_platform();
//    init_performance_counters(1);
//
//    // Hello World template
//    //----------------------
////    xil_printf("Begin\n\r");
////
////START_TIMING
////
////    xil_printf("Hello World Hoya!\n\r");
////
////STOP_TIMING
////
////	xil_printf("End\n\r");
//
//    // SW1: warmup exercise
//    //----------------------
//    //warmup();
//
//	// SW2: Add
//
//	//uint32_t a[32]   = { 0xe87c0891, 0xedefbacf, 0xbe75c544, 0xb29e5e19, 0x860c5ab6, 0xf1e491df, 0xc8d459fe, 0xc811c225, 0xc4870bec, 0x60af8542, 0xec8422a1, 0xa5d7ac12, 0x5e3ad006, 0xc99e51d9, 0xfb0db87f, 0xbf7d0d0c, 0x51777580, 0x77f88d79, 0x7437df95, 0x96787032, 0x38cfc8ca, 0xba87a2b5, 0x1de9b64c, 0x56905a55, 0xdf056077, 0x02edd0b8, 0x3a8af36b, 0x631da6cb, 0xde2f29a8, 0x3982f519, 0xb51e533c, 0xcabe8494 };
//	//uint32_t b[32]   = { 0x40ea3679, 0x13b7e95f, 0x961bf864, 0xd09d0a0a, 0x72ed6a7b, 0x2ac4de5b, 0x8b9ebd95, 0xcf2cdf20, 0x9b729071, 0x39e2ff0a, 0x8f04fa45, 0x9b16fe5a, 0x79366180, 0xff9d8257, 0x1060d96f, 0x3de121ba, 0xb30033c8, 0xaf5943cd, 0x65703523, 0xb2630421, 0x6d0e6319, 0xc99c9aa4, 0x45e02225, 0xac1523c7, 0x50471970, 0xd4cddec8, 0x7489978a, 0xa698959d, 0x4230dc65, 0xba17abc1, 0x15b5dc9b, 0x9651d473 };
//	//uint32_t res[33];
//	//uint32_t size=32;
//	//START_TIMING
//	//mp_add1(&a,&b,&res,size);
//	//mp_sub(&a,&b,&res,size);
//	//STOP_TIMING
//
//
//
//	uint32_t a[32]   = { 0xa2e47eba, 0xdb5e3e7d, 0x5fd9a7cb, 0x9e7a37c3, 0x4dc37416, 0x834fe315, 0x0080dbac, 0x47280a4d, 0x722dc3dd, 0x7f0ca6f4, 0x7f0da3db, 0xfc20cbb9, 0xb749699e, 0xc5abc925, 0x8bc67669, 0x23a30d3f, 0xffe44e1c, 0xdb22d6ee, 0x5dc3d3b3, 0xfe7e980d, 0x894075d2, 0xdeabe7c4, 0x58042c3b, 0x1cc18107, 0xf0abb2e1, 0x7bd31dc0, 0x72355db9, 0xf55a0178, 0x99f5d831, 0x12ccb47a, 0x44eef089, 0x81bf5831 };
//	uint32_t b[32]   = { 0xe47d092a, 0xd7615ed9, 0xa8aff661, 0xc3d7bb8c, 0x2d22b31c, 0x5050b808, 0xb0bc44bb, 0x93e46f4f, 0xac0332e5, 0x81ad7f85, 0x23de9197, 0x4b35f0a2, 0x6303744a, 0x615740bf, 0x54ebbaef, 0xf36273c2, 0xaf0d1080, 0x4740c9d6, 0x458e6699, 0xaaa1040b, 0x614df162, 0xaf7fe30d, 0xac73e3ed, 0x49204145, 0x1653523c, 0x5ee4f3b1, 0x2b3f4339, 0x5b9a2426, 0x62e3ffb3, 0xf4c32df1, 0x94f2db82, 0x80deb209 };
//	uint32_t N[33]   = { 0xb2e52d11, 0x8f850a5f, 0x08edfb0c, 0x4f02a1ac, 0xdd070636, 0x6c59cfc8, 0x16a40db7, 0x85bba009, 0x598eba07, 0x5d0fa3cc, 0x32bc6fb5, 0x4aa27cd0, 0x0928454e, 0x027d3081, 0xd1caec35, 0xa98e4223, 0x533983de, 0x36370bb4, 0xe8b0b4c6, 0xfe3655ab, 0x27a4a51e, 0xb403c449, 0xa679cf3b, 0xc1fc4391, 0x884e5080, 0xa65d4d30, 0xcd90ed67, 0x55fcb457, 0x989d6f4c, 0x0303d70e, 0x9a09328e, 0x82260dd0, 0x0};
//	uint32_t res[33];
//	uint32_t size=32;
//	START_TIMING
//	//mp_add1(&a, &b, &res, size);
//
//	mod_add(&a,&b,&N, &res, size);
//	STOP_TIMING
//
//	xil_printf("0x");
//	for(int32_t i=32; i>=0;i--){
//		xil_printf("%08x",res[i]);
//	}
//	xil_printf("\r\n");
//    cleanup_platform();
//
//    return 0;
//}

/******************************************************************
 * This is the main file for the Software Sessions
 *
 */

#include <stdint.h>
#include <inttypes.h>

#include "common.h"


// Uncomment for Session SW2 onwards
#include "mp_arith.h"
#include "montgomery.h"
#include "asm_func.h"

void print_num(uint32_t *in, uint32_t size)
{
    int32_t i;

    xil_printf("0x");
    for (i = size-1; i >= 0; i--) {
    	xil_printf("%08x", in[i]);
    }
    xil_printf("\n\r");
}


int main()
{
    init_platform();
    init_performance_counters(1);

#if 0
	// SW2: multi-precision add/sub
	//----------------------

    //add
    xil_printf("\r\nMP_ADD");
    uint32_t a1[32]   = { 0x5fb6d493, 0xdb0ee8be, 0x704a841e, 0xd09b1f41, 0xcf4f3870, 0xa0d90b3f, 0xdd34e375, 0x02c71f50, 0xbbe0bf21, 0x4cf7dd68, 0xdc580789, 0x9ee98638, 0x708b655f, 0x09c9cf5d, 0x6cbcb152, 0x2988bd7f, 0xa2883faa, 0xbb82748d, 0x9ab7bce3, 0x5dbe293f, 0x52322bd8, 0xaeffcd83, 0xee533ae0, 0x4d4ba990, 0x90ab358f, 0x8e7ff46d, 0xc1b445a6, 0x514f1554, 0x1ae5c5ef, 0xc5dc5c9d, 0x735ad8f6, 0x86580beb };
    uint32_t b1[32]   = { 0x3cf8d180, 0xe7f5a608, 0xc4b6a195, 0xc79d0d06, 0x84b0cdf3, 0x3e5105ed, 0xf06ba2e7, 0x6e29295e, 0x7a6bf7af, 0xfbcb45ef, 0x23192140, 0x173cb903, 0xfb3b0025, 0x419641aa, 0x62c5eae8, 0xa8b835dd, 0xc1b87288, 0x3f262083, 0x27816323, 0x2f7ca6e8, 0x55dc4b30, 0xfff8ded8, 0x1ba1bdf5, 0x5d4bb174, 0x538c03cf, 0x8e853091, 0x48d23333, 0xd3ca9ba6, 0x232b5d61, 0x31758358, 0x118250c0, 0xed8c5aa0 };
	uint32_t res1[33] = { 0x0};

START_TIMING
	mp_add(a1, b1, res1,32);
STOP_TIMING
	xil_printf("\r\nA=");
	print_num(a1, 32);
	xil_printf("B=");
	print_num(b1, 32);
	xil_printf("A+B=");
	print_num(res1, 33);


    //sub
    xil_printf("\r\nMP_SUB");
    uint32_t a2[32]   = { 0xfb7345ad, 0xa972161a, 0x56e7c032, 0xab115e34, 0x54edb161, 0x090b2cd8, 0xb38355cf, 0xfc215f78, 0x02b48c2b, 0x1cf2febf, 0x05f6c7cb, 0xfecea88b, 0x79f6ccea, 0x41258aef, 0x1700ee12, 0x9cf2fab6, 0x81a88642, 0x98df2823, 0xed1154ad, 0xf1bfd75a, 0x51d6de5b, 0xfb808b5f, 0xa622f7c1, 0x5e863645, 0x50142423, 0x9f1313bc, 0xcfef6e97, 0xdd0c07bd, 0x52222e67, 0x02ec3add, 0x06f7ef59, 0x8188c6ab };
    uint32_t b2[32]   = { 0x47f1272b, 0x3f499d07, 0xdc6d6ab3, 0x67ea2462, 0xa8e7a7d8, 0xe4606bb1, 0xcdf2a51f, 0x664b9758, 0x24302a2b, 0xdb256daf, 0xe1e72364, 0x540ba351, 0xad632f6b, 0x715f7e93, 0x91ccd071, 0x11b55bc7, 0xb8444a26, 0xe93a5379, 0x5b96d885, 0xd2d93a5f, 0x2e388bb5, 0x481ae889, 0xa97cc5c6, 0x3c2a5d0a, 0xb6f2b677, 0x02dec0fe, 0xab536a25, 0x5c57a3ed, 0x372426a1, 0x5c718d06, 0x3483f275, 0x802edb99 };
	uint32_t res2[32] = { 0x0};

START_TIMING
	mp_sub(a2, b2, res2,32);
STOP_TIMING
	xil_printf("\r\nA=");
	print_num(a2, 32);
	xil_printf("B=");
	print_num(b2, 32);
	xil_printf("A-B=");
	print_num(res2, 32);

	//mod_add
	xil_printf("\r\nMOD_ADD");


	uint32_t a3[32]   = { 0xa2e47eba, 0xdb5e3e7d, 0x5fd9a7cb, 0x9e7a37c3, 0x4dc37416, 0x834fe315, 0x0080dbac, 0x47280a4d, 0x722dc3dd, 0x7f0ca6f4, 0x7f0da3db, 0xfc20cbb9, 0xb749699e, 0xc5abc925, 0x8bc67669, 0x23a30d3f, 0xffe44e1c, 0xdb22d6ee, 0x5dc3d3b3, 0xfe7e980d, 0x894075d2, 0xdeabe7c4, 0x58042c3b, 0x1cc18107, 0xf0abb2e1, 0x7bd31dc0, 0x72355db9, 0xf55a0178, 0x99f5d831, 0x12ccb47a, 0x44eef089, 0x81bf5831 };
	uint32_t b3[32]   = { 0xe47d092a, 0xd7615ed9, 0xa8aff661, 0xc3d7bb8c, 0x2d22b31c, 0x5050b808, 0xb0bc44bb, 0x93e46f4f, 0xac0332e5, 0x81ad7f85, 0x23de9197, 0x4b35f0a2, 0x6303744a, 0x615740bf, 0x54ebbaef, 0xf36273c2, 0xaf0d1080, 0x4740c9d6, 0x458e6699, 0xaaa1040b, 0x614df162, 0xaf7fe30d, 0xac73e3ed, 0x49204145, 0x1653523c, 0x5ee4f3b1, 0x2b3f4339, 0x5b9a2426, 0x62e3ffb3, 0xf4c32df1, 0x94f2db82, 0x80deb209 };
	uint32_t N3[33]   = { 0xb2e52d11, 0x8f850a5f, 0x08edfb0c, 0x4f02a1ac, 0xdd070636, 0x6c59cfc8, 0x16a40db7, 0x85bba009, 0x598eba07, 0x5d0fa3cc, 0x32bc6fb5, 0x4aa27cd0, 0x0928454e, 0x027d3081, 0xd1caec35, 0xa98e4223, 0x533983de, 0x36370bb4, 0xe8b0b4c6, 0xfe3655ab, 0x27a4a51e, 0xb403c449, 0xa679cf3b, 0xc1fc4391, 0x884e5080, 0xa65d4d30, 0xcd90ed67, 0x55fcb457, 0x989d6f4c, 0x0303d70e, 0x9a09328e, 0x82260dd0, 0x0};
	uint32_t res3[33];
	uint32_t size=32;
START_TIMING
	mod_add(a3,b3,N3, res3, size);
STOP_TIMING
	xil_printf("\r\nA=");
	print_num(a3, 32);
	xil_printf("B=");
	print_num(b3, 32);
	xil_printf("N=");
	print_num(N3, 32);
	xil_printf("(A+B)modN=");
	print_num(res3, 32);


    //mod_sub
    xil_printf("\r\nMOD_SUB");
    uint32_t a4[32]   = { 0x58dbf779, 0x575740d6, 0x22f5f4ff, 0xfee2f9aa, 0xdfd7d85e, 0x6369df65, 0xdf4779e8, 0xefaca94e, 0xa685d499, 0xe4106396, 0x5909a0d5, 0x221befa0, 0x6ebbafcf, 0x31bdd396, 0xda56c836, 0x92800aa3, 0xecda33ae, 0x93e427b6, 0x092c226b, 0x4c7a5e39, 0x4df34625, 0x5fbaa5e8, 0x2a1ae27f, 0xbf51041f, 0x77437504, 0x60e47fed, 0xc677ca07, 0x336b2407, 0x255fdade, 0xdb69e9d1, 0x7588fd3b, 0x83433479 };
    uint32_t b4[32]   = { 0xa77c16c5, 0xfa4935b5, 0xc154ec99, 0x301e2643, 0xb8b8fbdf, 0xc3c8eda2, 0x3d1a8f84, 0x534e3da3, 0x87e0e5da, 0x85c63921, 0x1a47cdf4, 0xc0c2b332, 0xe8ff04bd, 0x0c36bd23, 0xa3c96c3e, 0x308ac41b, 0x2511d7fb, 0x716a9fa9, 0x2418ed5d, 0xcc81526b, 0xc9bbff34, 0x1d8b7599, 0x7eca3082, 0xa026b29d, 0x8377813d, 0x6dba7575, 0x08b7a520, 0xcafc2de6, 0xbf13cec1, 0x4479cc1a, 0xc3ecace7, 0x80b9fa75 };
    uint32_t n4[32]   = { 0xb672e01f, 0x92e9ace2, 0x0ab61389, 0x1302d058, 0x13a6ee9b, 0xfdfb1d3f, 0x2606e136, 0x5317fd7c, 0x4583fe0a, 0xccef8929, 0xf4d2744a, 0x0f13745c, 0xf6641cbe, 0x047608d8, 0xdb7b6221, 0xa2ef20b0, 0x14e04fad, 0x3350974c, 0x0f457ad3, 0xd0ae6914, 0xad9aecc8, 0xe87a5989, 0x92705dc5, 0x8efe769e, 0xfcc342dd, 0x62c646fd, 0x3f7d0ff3, 0xd3af71f1, 0x56483141, 0x0b516398, 0x288a7cfe, 0x83b3d8eb };
    uint32_t res4[32] = { 0x0};

//#if 0
START_TIMING
	mod_sub(a4, b4, n4, res4,32);
STOP_TIMING
	xil_printf("\r\nA=");
	print_num(a4, 32);
	xil_printf("B=");
	print_num(b4, 32);
	xil_printf("N=");
	print_num(n4, 32);
	xil_printf("(A-B)modN=");
	print_num(res4, 32);
#endif

/*--------------------------------------------------------------------------------------------------------
 * Montgomery Multiplication
--------------------------------------------------------------------------------------------------------*/
    xil_printf("\r\nMontgomery Multiplication\r\n");
    uint32_t a[32]         = { 0xa2e47eba, 0xdb5e3e7d, 0x5fd9a7cb, 0x9e7a37c3, 0x4dc37416, 0x834fe315, 0x0080dbac, 0x47280a4d, 0x722dc3dd, 0x7f0ca6f4, 0x7f0da3db, 0xfc20cbb9, 0xb749699e, 0xc5abc925, 0x8bc67669, 0x23a30d3f, 0xffe44e1c, 0xdb22d6ee, 0x5dc3d3b3, 0xfe7e980d, 0x894075d2, 0xdeabe7c4, 0x58042c3b, 0x1cc18107, 0xf0abb2e1, 0x7bd31dc0, 0x72355db9, 0xf55a0178, 0x99f5d831, 0x12ccb47a, 0x44eef089, 0x81bf5831 };
    uint32_t b[32]         = { 0xe47d092a, 0xd7615ed9, 0xa8aff661, 0xc3d7bb8c, 0x2d22b31c, 0x5050b808, 0xb0bc44bb, 0x93e46f4f, 0xac0332e5, 0x81ad7f85, 0x23de9197, 0x4b35f0a2, 0x6303744a, 0x615740bf, 0x54ebbaef, 0xf36273c2, 0xaf0d1080, 0x4740c9d6, 0x458e6699, 0xaaa1040b, 0x614df162, 0xaf7fe30d, 0xac73e3ed, 0x49204145, 0x1653523c, 0x5ee4f3b1, 0x2b3f4339, 0x5b9a2426, 0x62e3ffb3, 0xf4c32df1, 0x94f2db82, 0x80deb209 };
    uint32_t N[32]         = { 0xb2e52d11, 0x8f850a5f, 0x08edfb0c, 0x4f02a1ac, 0xdd070636, 0x6c59cfc8, 0x16a40db7, 0x85bba009, 0x598eba07, 0x5d0fa3cc, 0x32bc6fb5, 0x4aa27cd0, 0x0928454e, 0x027d3081, 0xd1caec35, 0xa98e4223, 0x533983de, 0x36370bb4, 0xe8b0b4c6, 0xfe3655ab, 0x27a4a51e, 0xb403c449, 0xa679cf3b, 0xc1fc4391, 0x884e5080, 0xa65d4d30, 0xcd90ed67, 0x55fcb457, 0x989d6f4c, 0x0303d70e, 0x9a09328e, 0x82260dd0 };
    uint32_t n_prime[32]   = { 0xfb5c9c0f, 0xd3cbec85, 0x3a126c50, 0x0f85259a, 0xb93b900a, 0x89feafbe, 0x30847469, 0x0a87f885, 0x9d5bfa86, 0xec1adae0, 0x448a3dac, 0xa7194e08, 0x61c37198, 0xd5eff8a8, 0xf96efef1, 0x473d83aa, 0xe7c048dd, 0xb1893377, 0xc843e910, 0xcd3b86d2, 0x2119b9dd, 0x6caed27a, 0x7ebcc873, 0x2019cd09, 0x240e3495, 0x040754fb, 0xdfef2830, 0x32a287d7, 0x8e79f7e4, 0x3daeb7e0, 0xbeaeac00, 0x376725cd };
    uint32_t eres[32]       = { 0x919af36d, 0x201c5a15, 0x763debb4, 0x54b92abd, 0xc3d09af8, 0x0269454a, 0x35a42e09, 0x1149a6e6, 0x381cfa5b, 0x61b91a68, 0x7180faf5, 0x8c7536c6, 0x0368f56d, 0x0ce9c2ab, 0xd6180f19, 0x0cf8b5ac, 0x62ca69e8, 0x8789e2ec, 0x080ca2ea, 0x4dea79c7, 0xf3b4499d, 0xbae3cd24, 0x148e24af, 0x83e7cc56, 0x22548763, 0x1e0f13bf, 0xc6b26d8e, 0xfc9c092d, 0x8fa70ce2, 0xb5098439, 0x9f7d1f55, 0x50a9e0c6 };



    //uint32_t a[32] = {0xf484e847, 0x4ae251f1, 0xedfa617d, 0x58ab6bf4, 0x46bf4848, 0xf67c1061, 0x8811c17a, 0x578fde16, 0x493ee595, 0x1eafc4c3, 0xc4f11a2e, 0x8cb6fba7, 0x724c03a4, 0x2e6c1dbd, 0x57ebc43d, 0x3e6ee260, 0x4089c050, 0xf0384e03, 0x7357f72c, 0x87acb658, 0x7ea2490e, 0x61069112, 0x42e3f8b9, 0x9e778cef, 0x5cdf77c7, 0x10bce41c, 0x1121beec, 0x3db59a36, 0xc34620c5, 0xc6b030ae, 0xe8fc5934, 0x63a0a0cb};
    //uint32_t b[32] = {0xfeb1b9f4, 0xe91d3bec, 0xfb09354d, 0x07f21d6d, 0x9ece9e1b, 0x18def18b, 0x4119e1e9, 0x55c85f24, 0x60ef0e23, 0x10e8ab54, 0x1e95cdcc, 0x4373912f, 0x6f42204d, 0x7126650d, 0xb61c1c8d, 0x98af9011, 0xa42c03b4, 0xd29e0870, 0x7923cb60, 0xdf87cfe5, 0xde4fffa0, 0x3ce537ca, 0x201040c6, 0x6e54b058, 0x814c53dc, 0xf16243f0, 0x57decf64, 0x8d0d4f37, 0x9b6d93e5, 0x45396d71, 0x615213c4, 0x65f89f9f};
    //uint32_t N[33] = {0x4aeeb107, 0x5d78aa98, 0x6c55dd05, 0x6f5326c9, 0xf93f738c, 0xc10fa093, 0x20478120, 0x099d6d70, 0x833d9b82, 0x1248f3ed, 0xa43ed737, 0xc1c1da45, 0x9f23e5c7, 0xb17c3598, 0xe8938df6, 0x7ae59036, 0x9f84d87b, 0xc8710dc6, 0x249ee0f8, 0x46eeae2f, 0x66a3bb9b, 0xfeef4c6b, 0xc7b55eae, 0x7951dd0c, 0x0b4391e8, 0x141ad586, 0x1a568588, 0x908293dd, 0x472c0bea, 0x8d00abfe, 0xed17377f, 0x83a01efe,0x0};
    //uint32_t n_prime[32] = {0xe7d41349, 0x0c828dcd, 0x2dc06d90, 0x318f87bf, 0x1992ba09, 0x4b1bef10, 0x011ba664, 0xe3a7d9cf, 0x44449fbd, 0x89714d34, 0x6cd49cc4, 0x49c5b99d, 0xf90435b1, 0x38f037b7, 0xba9720db, 0x9641b106, 0xbca01d2a, 0xfdb82893, 0xbd7ce9c7, 0x372823e1, 0x4901cdde, 0xaa28d457, 0xe9f78c94, 0xb6e1e5b3, 0x5a79f7a6, 0xf5212a83, 0x2b1aab45, 0xa3924b69, 0x3c63a8af, 0x12fa121d, 0x7500bea0, 0xe58878e7};
    uint32_t res[32]={0};
    uint32_t size = 32;

//    START_TIMING
//	montMul(a, b, N, n_prime, res, size);
//    STOP_TIMING

	xil_printf("\r\nA=");
	print_num(a, 32);
	xil_printf("B=");
	print_num(b, 32);
//	xil_printf("N=");
	//print_num(N, 32);
//	xil_printf("N_PRIME=");
	//print_num(n_prime, 32);
	xil_printf("eres =");
	print_num(eres, 32);
	xil_printf("\n\r");


    START_TIMING
    montMulOpt(a, b, N, n_prime, res, size);
    STOP_TIMING



	xil_printf("res =");
	print_num(res, 32);
	xil_printf("\n\r");

//	START_TIMING
	//uint32_t test[5]={1,2,3,4,5};
	uint32_t i;


//	STOP_TIMING
//	xil_printf("i=%d\n\r",i );
//	START_TIMING
//	uint32_t test_res=test1();
//	STOP_TIMING
//	xil_printf("test res =%d\n\r",test_res );

//	uint32_t aa=1;
//	uint32_t ba=2;
//	uint32_t ca=10;
//	uint32_t add= add_3(aa,  ba,  ca);
//    xil_printf("res= %d\r\n",add  );
//
//	uint32_t caa[3]={300,200,100};
//	add_10(&caa, 3);
//
//	int resc=0;
//
//	uint32_t mul= multiply( uint32_t i, uint32_t *t, uint32_t *a, uint32_t *b, uint32_t *m, uint32_t *n);
//    STOP_TIMING
//	  xil_printf("res= %d\r\n",add1  );

//	uint32_t mo[2];
//	uint32_t ho[2];
//	uint32_t ti[2];
//	mo = {1 , 2};
//	ho = {4 , 5} ;
//	uint32_t c = 0;
//	for ( uint32_t ii = 0 ; ii <2 ; ii++) {
//	uint32_t sss = opt_multiply(  mo[ii],  ho[ii],  ii, &ti, c);
//	xil_printf("sss= %d\r\n",sss  );
//	}


	cleanup_platform();


    return 0;
}
